<?xml version='1.0' encoding='windows-1251' ?>
<ui:composition 
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:c="http://java.sun.com/jstl/core">

<h3 class="ui-widget-header" >Подробно</h3>
<div class="ui-layout-content">
<a4j:outputPanel id="outCenterBottom">

<table style="width:100%;" border="0">
<tr>
<td width="90%">
  
 <!--s:div style="margin:5px;" rendered="#{param['sessionId']!=null}"-->
 <div style="margin:5px;"> 
  
 <c:if test="#{usrManager.evaluteForBean}"> 
  
  <h:form>

  <h:messages style="color:red" globalOnly="false" />
 
    <table style="width:100%; font-size:12px;" border="0">
          <c:forEach items="#{usrManager.auditItemsListContext}" var="field"> 
          <!--a4j:repeat var="field" rowKeyVar="rkv"
                      value="#{usrManager.auditItemsListContext}"-->
           <tr>
            <td width="150px" height="25px" class="table_left_header">
              <h:outputText value="#{field.itemLabel}"/>
            </td>
            <td>
               <h:outputText value="#{usrBean[field.itemField]}"/>
            </td>
          </tr>
         <!--/a4j:repeat-->
         </c:forEach>    
          <tr>
            <td width="150px" height="25px" valign="top" 
                style="padding-top:10px;" class="table_left_header">
               <h:outputText value="Роли:"/>
            </td>
            <td style="padding-top:10px;" valign="top">
            <table style="width:100%;" border="0">
             <c:forEach items="#{usrManager.listUsrArmForView}" var="vrecord"> 
             <!--a4j:repeat var="vrecord" value="#{usrManager.listUsrArmForView}"-->
               <tr>
                 <td height="15" style="font-weight:bold;">
                   <h:outputText value=" #{vrecord.name}:" />
                 </td>
               </tr>
               <tr>
                 <td>
                   <table style="width:100%;margin-bottom:10px;">
                     <c:forEach items="#{vrecord.rolList}" var="vit"> 
                     <!--ui:repeat var="vit" value="#{vrecord.rolList}"-->
                      <tr>
                        <td height="15" style="padding-left:30px;">
                          <h:outputText value=" #{vit.roleTitle}" />
                         </td>
                       </tr>
                     <!--/ui:repeat-->
                     </c:forEach> 
                    </table> 
                 </td>
               </tr>
               <!--/a4j:repeat-->
               </c:forEach>  
             </table> 
           </td>
          </tr>
          <tr>
            <td width="150px" height="25px" class="table_left_header">
              <h:outputText value="Создал"/>
            </td>
            <td>
               <h:outputText value="#{usrBean.crtUserName}"/>
            </td>
          </tr>
          <tr>
            <td width="150px" height="25px" class="table_left_header">
              <h:outputText value="Дата создания"/>
            </td>
            <td>
               <h:outputText value="#{usrBean.created}">
                  <s:convertDateTime pattern="dd.MM.yy HH:mm:ss"/>
               </h:outputText>   
            </td>
          </tr>
          <tr>
            <td width="150px" height="25px" class="table_left_header">
              <h:outputText value="Редактировал"/>
            </td>
            <td>
               <h:outputText value="#{usrBean.updUserName}"/>
            </td>
          </tr>
          <tr>
            <td width="150px" height="25px" class="table_left_header">
              <h:outputText value="Дата редактирования"/>
            </td>
            <td>
               <h:outputText value="#{usrBean.modified}">
                  <s:convertDateTime pattern="dd.MM.yy HH:mm:ss"/>
               </h:outputText>
            </td>
          </tr>
         </table>
        </h:form>
      </c:if>
       </div>
       <!--/s:div-->
   </td>
   <td width="90px" valign="top">
    <!--rich:panel style="margin:5px 5px 0 0;">
     <f:facet name="header">
       Действия:
      </f:facet>
     <a4j:form>
      <a4j:commandButton style="width:60px;" value="Создать"
       reRender="outCBmpCrt" ajaxSingle="true"
       oncomplete="#{rich:component('CBmpCrt')}.show();"
       rendered="#{authenticator.accessPerm('002','2')}"
       styleClass="but_class">
          <f:param name="onCreate" value="1"/>
      </a4j:commandButton>
     
     <s:div rendered="#{param['idUsr']!=null}">
       <a4j:commandButton style="margin-top:5px;width:60px;"
         ajaxSingle="true" reRender="outCBmpUpd"
         value="Изменить" action="#{usrManager.forView}"
         oncomplete="#{rich:component('CBmpUpd')}.show();"
         rendered="#{authenticator.accessPerm('002','3')}"
         styleClass="but_class">
         <f:param name="onUpdate" value="1"/>
         <f:param name="idUsr" value="#{param['idUsr']}"/>
       </a4j:commandButton>
       
       <a4j:commandButton 
         reRender="outCBmpDel"
         value="Удалить"  style="margin-top:5px;width:60px;"
         action="#{usrManager.forView}"
         oncomplete="#{rich:component('CBmpDel')}.show();"
         rendered="#{authenticator.accessPerm('002','4')}"
         styleClass="but_class">
         <f:param name="onDelete" value="1"/>
         <f:param name="idUsr" value="#{param['idUsr']}"/>
       </a4j:commandButton>
    
     </s:div>
    </a4j:form>
   </rich:panel-->
 </td>
 </tr>
 </table>
  
  </a4j:outputPanel>
 
 </div>
 
 <div class="ui-widget-footer" style="background:#E6E6E6;">
 
 <!--a4j:outputPanel id="outCBmpCrtPre">
   <rich:modalPanel id="CBmpCrtPre" rendered="#{param['onCreatePre']!=null or param['onCreate']!=null}"
    width="600" autosized="true" onbeforeshow="setHDiv('CBmpCrtHDivPre');">
      <f:facet name="header">
            <h:panelGroup>
                <h:outputText value="Пользователь"></h:outputText>
             </h:panelGroup>
      </f:facet>
       <f:facet name="controls">
            <h:panelGroup>
                <h:graphicImage onclick="#{rich:component('CBmpCrtPre')}.hide();"
                value="/img/icons/close.gif" />
              </h:panelGroup>
        </f:facet>
        <div id="CBmpCrtHDivPre" style="width:100%;height:500px;overflow:auto;"> 
         <h:form id="CBformCrtPre">
           <table style="width:90%;">
           <tr>
            <td>
            <h:outputText value="Фамилия"/></td>
            <td></td>
           </tr>
           
          <tr>
           <td align="center" height="35px">
              <a4j:commandButton value="Отмена"
                     onclick="#{rich:component('CBmpCrtPre')}.hide();return false;"
                     styleClass="but_class"/>
               <a4j:commandButton style="width:60px;" value="Создать2"
                reRender="outCBmpCrt"
                action="#{usrManager.forViewCrt}"
                oncomplete="#{rich:component('CBmpCrt')}.show();"
                rendered="#{authenticator.accessPerm('002','2')}"
                styleClass="but_class"
                onclick="#{rich:component('CBmpCrtPre')}.hide();">
            <f:param name="onCreate" value="1"/>
            <f:param name="remoteAudit" value="OpenCrtFact"/>
            <f:param name="#{param['sessionId']!=null ? 'sessionId' : 'xxx1'}" value="#{param['sessionId']}"/>
          </a4j:commandButton>
               </td>
            </tr>
            </table>
            </h:form>
        </div>
       </rich:modalPanel>
     </a4j:outputPanel-->
 
 
 <a4j:outputPanel id="outCBmpCrt">
   <rich:modalPanel id="CBmpCrt" rendered="#{param['onCreate']!=null}"
    width="600" autosized="true" onbeforeshow="/*setHDiv('CBmpCrtHDiv');*/document.getElementById('CBformCrt:statesinput').value='';">
      <f:facet name="header">
            <h:panelGroup>
                <h:outputText value="Пользователь"></h:outputText>
             </h:panelGroup>
      </f:facet>
       <f:facet name="controls">
            <h:panelGroup>
                <h:graphicImage onclick="#{rich:component('CBmpCrt')}.hide();"
                value="/img/icons/close.gif" />
              </h:panelGroup>
        </f:facet>
        <!--div id="CBmpCrtHDiv" style="width:100%;height:500px;overflow:auto;"--> 
         <h:form id="CBformCrt">
         
         
              <!--rich:comboBox selectFirstOnUpdate="false"
               defaultLabel="Enter some value">
               <s:selectItems value="#{clOrgManager.listOrg}" var="ind" label="#{ind.full}"/>
               <s:convertEntity />
             </rich:comboBox-->
             
           <table style="width:90%;">
           <tr>
            <td width="100px" height="20px">
            <h:outputText value="Организация"/></td>
            <td>
            <a4j:status startText="Выполняется загрузка...."  startStyle="color:green;font: bold 8pt arial" 
              id="statusCompOrg" forceId="true" />
             <a4j:region>
              <h:panelGrid columns="3" border="0" cellpadding="0" cellspacing="0">
                <h:inputText maxlength="50" size="55" style="margin:0px;" id="statesinput"/>
                <h:graphicImage value="/img/error.gif"
                    onclick="document.getElementById('CBformCrt:statesinput').value='';"
                    alt="" />
                <h:graphicImage value="/img/icons/arrow.png"
                    onclick="#{rich:component('suggestion')}.callSuggestion(true)"
                    alt="" />
            </h:panelGrid>
          <rich:suggestionbox height="400" width="500" status="statusCompOrg"
            usingSuggestObjects="true"  for="statesinput" 
            suggestionAction="#{clOrgManager.autocomplete}" var="cap"
            fetchValue="#{cap.full}" id="suggestion"
             minChars="1" ajaxSingle="true" 
             onselect="invokeClOrgSelect(#{rich:component('suggestion')}.getSelectedItems().pluck('signObject'));"
             nothingLabel="Нет данных">
              <f:param name="onCreate" value="1"/> 
              <f:param name="remoteAudit" value="clOrgSuggestFact"/>
            <!--h:column>
                <h:outputText value="#{cap.signObject}" />
            </h:column-->
            <h:column>
                <h:outputText value="#{cap.full}" />
            </h:column>
            <!--a4j:support event="onselect" ajaxSingle="true" reRender="outCBmpUsrCrt">
              <f:param name="onCreate" value="1"/> 
              <f:param name="remoteAudit" value="clOrgSelectFact"/>
              <f:param name="signObject" value="#{cap.signObject}"/>
              <f:setPropertyActionListener value="#{cap.label}" target="#{bean.property1}" />
            </a4j:support-->
        </rich:suggestionbox>
          </a4j:region>
          
           
        </td>
           </tr>
           <tr>
            <td colspan="2">
            <a4j:outputPanel id="outCBmpOrgHiddenCrt" >
            
             <h:inputHidden  id ="clorgso" value="#{clOrgBean.signObject}"/>
             
             <h:panelGroup rendered="#{param['signObject']!=null}">
        <table style="width:99%;">
         <tr>
            <td width="100px" height="20px" valign="top">
            <h:outputText value="Выбрана организация"/></td>
            <td> 
             <!--h:panelGrid columns="2" border="0" cellpadding="0" cellspacing="0">
                <h:outputText value="Название: " /-->
                <h:outputText value="#{clOrgBean.full}" />
             <!--/h:panelGrid-->
        </td>
        </tr>
        </table>
        </h:panelGroup>
           </a4j:outputPanel>
            </td>
            </tr>
            
           <tr>
            <td width="100px" height="20px" valign="top">
            <h:outputText value="Пользователь"/></td>
            <td>
             <h:selectOneRadio id="stiu" layout="lineDirection" 
                               value="1" onchange="invokeTypeUserInput(this.value);">
	  	       <f:selectItem itemLabel="из справочника" itemValue="1"/>
	  	       <f:selectItem itemLabel="ручной ввод" itemValue="2"/>
              </h:selectOneRadio>
            </td>
            </tr>
             <tr>
            <td colspan="2">
            
            
         <a4j:outputPanel id="outCBmpUsrFIOSectCrt" >    
            
         <h:panelGroup rendered="#{(param['remoteAudit']!='CrtFact' and param['typeUserInput']!='2') or (param['remoteAudit']=='CrtFact' and param['CBformCrt:cluso']!=null)}">
           <!--/table-->
       <!--rich:tabPanel switchType="client" style="margin-bottom:10px;">
          <rich:tab label="Справочник" style="padding-top:10px;"-->
          <table style="width:99%;">
            <tr>
            <td width="100px" height="20px" valign="top">
            <h:outputText value="ФИО"/></td>
            <td>
        <a4j:outputPanel id="outCBmpUsrCrt" >   
             
        <h:panelGroup rendered="#{param['signObject']!=null 
               and (param['remoteAudit']=='clOrgSelectFact' 
               or param['remoteAudit']=='clUsrSuggestFact'
               or param['remoteAudit']=='clUsrTUIFact')}">
       
        <a4j:status startText="Выполняется загрузка...."  startStyle="color:green;font: bold 8pt arial" 
              id="statusCompUsr" forceId="true" />
        <a4j:region>
              <h:panelGrid columns="3" border="0" cellpadding="0" cellspacing="0">
                <h:inputText maxlength="50" size="55" style="margin:0px;" id="statesinput_usr" />
                 <h:graphicImage value="/img/error.gif"
                    onclick="document.getElementById('CBformCrt:statesinput_usr').value='';"
                    alt="" />
                <h:graphicImage value="/img/icons/arrow.png"
                    onclick="#{rich:component('suggestion_usr')}.callSuggestion(true)"
                    alt="" />
               
            </h:panelGrid>
          <rich:suggestionbox height="400" width="500" status="statusCompUsr"
            usingSuggestObjects="true"  for="statesinput_usr" 
            suggestionAction="#{clUsrManager.autocomplete}" var="cap"
            fetchValue="#{cap.fio}" id="suggestion_usr"
             minChars="1" ajaxSingle="true"
             onselect="invokeClUsrSelect(#{rich:component('suggestion_usr')}.getSelectedItems().pluck('signObject'));"
             nothingLabel="Нет данных">
              <f:param name="onCreate" value="1"/> 
              <f:param name="remoteAudit" value="clUsrSuggestFact"/>
              <f:param name="signObject" value="#{param['signObject']}"/>
            <!--h:column>
                <h:graphicImage value="#{cap.stateFlag}" />
            </h:column-->
            <h:column>
                <h:outputText value="#{cap.fio}" />
            </h:column>
            <!--a4j:support event="onselect" action="#{bean.action}">
              <f:setPropertyActionListener value="#{cap.label}" target="#{bean.property1}" />
           </a4j:support-->
        </rich:suggestionbox>
        </a4j:region>
        </h:panelGroup>
        
        
        <h:panelGroup rendered="#{!(param['signObject']!=null 
               and (param['remoteAudit']=='clOrgSelectFact' 
               or param['remoteAudit']=='clUsrSuggestFact'
               or param['remoteAudit']=='clUsrTUIFact'))}">
        <h:outputText value="Не выбрана организация" style="font-style:italic; color:silver;"/>
       </h:panelGroup>
        </a4j:outputPanel>
 
       </td>
      </tr> 
        <tr>
            <td colspan="2">      
         <a4j:outputPanel id="outCBmpUsrDataCrt" >   
      
         <h:inputHidden id ="cluso" value="#{clUsrBean.signObject}"/>
         
        <h:panelGroup rendered="#{param['remoteAudit']=='clUsrSelectFact'}">
        <table style="width:99%;">
         <tr>
            <td width="100px" height="20px" valign="top">
            <h:outputText value="Выбран пользователь"/></td>
            <td> 
            <!--h:outputText value="#{cap.fio}" /-->
             <h:panelGrid columns="2" border="0" cellpadding="0" cellspacing="0">
                <h:outputText value="ФИО: " />
                <h:outputText value="#{clUsrBean.fio}" />
                <h:outputText value="Должность: " />
                <h:outputText value="#{clUsrBean.position}" />
                <h:outputText value="Телефон:" />
                <h:outputText value="#{clUsrBean.phone}" />
                <h:outputText value="E-mail:" />
                <h:outputText value="#{clUsrBean.email}" />
            </h:panelGrid>
        </td>
        </tr>
        </table>
        </h:panelGroup>
        </a4j:outputPanel>
        
      </td>
      </tr>
      </table>
      </h:panelGroup>
          <h:panelGroup rendered="#{(param['remoteAudit']!='CrtFact' and param['typeUserInput']=='2') or (param['remoteAudit']=='CrtFact' and param['CBformCrt:cluso']==null)}">
         <!--/rich:tab>
          <rich:tab label="Произвольное" style="padding-top:10px;"-->
          <table style="width:90%;">
           <tr>
            <td width="100px" height="20px">
            <h:outputText value="Фамилия"/></td>
            <td><h:inputText value="#{usrBeanCrt.surname}"
                          id="name1" maxlength="30" size="55"/></td>
           </tr>
           <tr>
            <td width="100px" height="20px">
            <h:outputText value="Имя"/></td>
            <td><h:inputText value="#{usrBeanCrt.name1}"
                           id="name2" maxlength="30" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Отчество"/></td>
            <td><h:inputText value="#{usrBeanCrt.name2}"
                            id="name3" maxlength="30" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Телефон"/></td>
            <td><h:inputText value="#{usrBeanCrt.phone}"
                             id="tel" maxlength="50" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="E-mail"/></td>
            <td><h:inputText value="#{usrBeanCrt.email}"
                             id="email" maxlength="50" size="55"/></td>
            </tr>
              </table>
             </h:panelGroup> 
        
         </a4j:outputPanel>    
              </td>
              </tr>
              </table>
             <!--/rich:tab>
           
            </rich:tabPanel-->
            <table style="width:90%;">
            <!--tr>
            <td width="100px" height="20px">
            <h:outputText value="Организация"/></td>
            <td style="padding-top:5px;padding-bottom:5px;">
             <h:selectOneMenu style="width:300px;" 
                              value="#{usrBeanCrt.acOrganization}"
                              id="org">
             <f:selectItem itemLabel="+++" itemValue="-1"/>
	  	     <s:selectItems value="#{orgManager.listOrg}"
	  	               var="n"
	  	               label="#{n.fullName}"
                       itemValue="#{n.idOrg}"/>
             </h:selectOneMenu>
               </td>
            </tr-->
            
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Логин"/></td>
            <td><h:inputText value="#{usrBeanCrt.login}"
                             id="login" maxlength="15" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Пароль"/></td>
            <td><h:inputText value="#{usrBeanCrt.password}"
                        id="pass" maxlength="15" size="55"/></td>
            </tr>
             <tr>
            <td width="100px" height="20px">
            <h:outputText value="Номер сертификата"/></td>
            <td><h:inputText value="#{usrBeanCrt.certificate}"
                             id="cert" maxlength="15" size="55"/></td>
            </tr> 
            <tr>
             <td width="100px" height="25px">
               <h:outputText value="Дата начала"/></td>
             <td>
             <rich:calendar value="#{usrBeanCrt.start}"
				  locale="RU"
				  datePattern="dd.MM.yy"
				  todayControlMode="hidden"
				  id="sdate"/>
             </td>
            </tr>
            <tr>
             <td width="100px" height="25px">
               <h:outputText value="Дата окончания"/></td>
             <td>
             <rich:calendar value="#{usrBeanCrt.finish}"
				  locale="RU"
				  datePattern="dd.MM.yy"
				  todayControlMode="hidden"
				  id="fdate"/>
             </td>
            </tr>
          
           <tr>
           <td colspan="2" align="center" height="35px">
              <a4j:commandButton value="Отмена"
                     onclick="#{rich:component('CBmpCrt')}.hide();return false;"
                     styleClass="but_class"/>
               <a4j:commandButton value="Сохранить"
                    action="#{usrManager.addUsr}"
                    reRender="outCenterCenter, outCenterCenterFooter"
                    oncomplete="#{usrManager.addLoginExist ? 'alert(\'Такой логин уже существует!\')' : 'hideMPCrt();' }"
                    onclick="if(check_crt('CBformCrt')){return false;}"
                    styleClass="but_class">
                   <f:param name="onCreate" value="1"/> 
                   <f:param name="remoteAudit" value="CrtFact"/> 
                   <f:param name="#{param['sessionId']!=null ? 'sessionId' : 'xxx1'}" value="#{param['sessionId']}"/> 
              </a4j:commandButton>
            
              <!--a4j:commandButton value="Сохранить2"
                    action="#{usrManager.addUsr}"
                    reRender="outCenterCenter,outAddMessage"
                    oncomplete="#{usrManager.addLoginExist ? 'alert(\'Такой логин уже существует!\')' : 'hideMPCrt();' }"
                    styleClass="but_class">
                   <f:param name="onCreate" value="1"/>  
              </a4j:commandButton-->
             </td>
            </tr>
            </table>
            
            </h:form>
        <!--/div-->
       </rich:modalPanel>
     </a4j:outputPanel>
     
     <a4j:outputPanel id="outCBmpUpd">  
      <rich:modalPanel id="CBmpUpd" rendered="#{param['onUpdate']!=null}"
        width="600" autosized="true" onbeforeshow="/*setHDiv('CBmpUpdHDiv');*/">
        <f:facet name="header">
            <h:panelGroup>
                <h:outputText value="Пользователь"></h:outputText>
             </h:panelGroup>
        </f:facet>
        <f:facet name="controls">
            <h:panelGroup>
                <h:graphicImage onclick="#{rich:component('CBmpUpd')}.hide();"
                value="/img/icons/close.gif"/>
              </h:panelGroup>
        </f:facet>
        <!--div id="CBmpUpdHDiv" style="width:100%;height:500px;overflow:auto;"-->
        <h:form id="CBformUpd">
        
        <!--h:inputHidden id ="uorgid" value="#{usrBean.acClOrganization}"/>
        <h:inputHidden id ="ucluid" value="#{usrBean.acClUser}"/-->
          
         <table style="width:90%;">
          <tr>
            <td width="100px" height="20px">
            <h:outputText value="Организация"/></td>
            <td><h:inputText value="#{usrBean.acClOrganization2.full}"
                 id="org" maxlength="30" size="55" disabled="true"/></td>
            </tr>
         <tr>
            <td colspan="2">
            <c:if test="#{usrBean.acClUser==null}">
             <table style="width:99%;">
             <tr>
            <td width="100px" height="20px">
            <h:outputText value="Фамилия"/></td>
            <td><h:inputText value="#{usrBean.surname}"
                 id="name1" maxlength="30" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Имя"/></td>
            <td><h:inputText value="#{usrBean.name1}"
                  id="name2" maxlength="30" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Отчество"/></td>
            <td><h:inputText value="#{usrBean.name2}"
                 id="name3" maxlength="30" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Телефон"/></td>
            <td><h:inputText value="#{usrBean.phone}"
                 id="tel" maxlength="50" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="E-mail"/></td>
            <td><h:inputText value="#{usrBean.email}"
                id="email" maxlength="50" size="55"/></td>
            </tr>
             </table>
             </c:if>
             <c:if test="#{usrBean.acClUser!=null}">
             <table style="width:99%;">
             <tr>
            <td width="100px" height="20px">
            <h:outputText value="ФИО"/></td>
            <td><h:inputText value="#{usrBean.acClUser2.fio}"
                 id="fio" maxlength="30" size="55" disabled="true"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Должность"/></td>
            <td><h:inputText value="#{usrBean.acClUser2.position}"
                  id="dolj" maxlength="30" size="55" disabled="true"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Телефон"/></td>
            <td><h:inputText value="#{usrBean.acClUser2.phone}"
                 id="tel" maxlength="30" size="55" disabled="true"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="E-mail"/></td>
            <td><h:inputText value="#{usrBean.acClUser2.email}"
                 id="email" maxlength="50" size="55" disabled="true"/></td>
            </tr>
            </table>
           </c:if>
          </td>
         </tr>
         
           <!--tr>
            <td width="100px" height="20px">
            <h:outputText value="Фамилия"/></td>
            <td><h:inputText value="#{usrBean.surname}"
                 id="name1" maxlength="30" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Имя"/></td>
            <td><h:inputText value="#{usrBean.name1}"
                  id="name2" maxlength="30" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Отчество"/></td>
            <td><h:inputText value="#{usrBean.name2}"
                 id="name3" maxlength="30" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Телефон"/></td>
            <td><h:inputText value="#{usrBean.phone}"
                 id="tel" maxlength="50" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="E-mail"/></td>
            <td><h:inputText value="#{usrBean.email}"
                id="email" maxlength="50" size="55"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Организация"/></td>
            <td style="padding-top:5px;padding-bottom:5px;">
            <h:selectOneMenu style="width:300px;" id="org"
                             value="#{usrBean.acOrganization}">
             <f:selectItem itemLabel="+++" itemValue="-1"/>                   
	  	     <s:selectItems value="#{orgManager.listOrg}"
	  	               var="n"
	  	               label="#{n.fullName}"
                       itemValue="#{n.idOrg}"/>
             </h:selectOneMenu>
             </td>
            </tr-->
            
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Логин"/></td>
            <td><h:inputText value="#{usrBean.login}"
                id="login" maxlength="15" size="55"
                disabled="true"/></td>
            </tr>
            <tr>
            <td width="100px" height="20px">
            <h:outputText value="Пароль"/></td>
            <td><h:inputText value="#{usrBean.password}"
              id="pass" maxlength="15" size="55"/></td>
            </tr>
             <tr>
            <td width="100px" height="20px">
            <h:outputText value="Номер сертификата"/></td>
            <td><h:inputText value="#{usrBean.certificate}"
                id="cert" maxlength="15" size="55"
                disabled="true"/></td>
            </tr>
             <c:if test="#{currentUser.idUser!=linksMap.superUserCode or usrBean.idUser!=linksMap.superUserCode}"> 
             
             <tr>
             <td width="100px" height="25px">
               <h:outputText value="Дата начала"/></td>
             <td>
             <rich:calendar value="#{usrBean.start}"
				  locale="RU"
				  datePattern="dd.MM.yy"
				  todayControlMode="hidden"
				  id="sdate"/>
             </td>
            </tr>
            <tr>
             <td width="100px" height="25px">
               <h:outputText value="Дата окончания"/></td>
             <td>
             <rich:calendar value="#{usrBean.finish}"
				  locale="RU"
				  datePattern="dd.MM.yy"
				  todayControlMode="hidden"
				  id="fdate"/>
             </td>
            </tr>
            
            
            </c:if>
           
            
            
            <!--/c:if-->
            
            <tr>
            <td colspan="2" align="center" height="35px">
                 <a4j:commandButton value="Отмена"
                     onclick="#{rich:component('CBmpUpd')}.hide();return false;"
                     styleClass="but_class"/>
                 <a4j:commandButton value="Сохранить"
                    action="#{usrManager.updUsr}"
                    reRender="outCenterCenter, outCenterBottom"
                    oncomplete="#{rich:component('CBmpUpd')}.hide();"
                    onclick="if(check_upd('CBformUpd')){return false;}else{enableCHBox('CBformUpd');}" 
                    styleClass="but_class">
                    <f:param name="onUpdate" value="1"/> 
                    <f:param name="remoteAudit" value="UpdFact"/> 
                    <f:param name="sessionId" value="#{param['sessionId']}"/>
                    <f:param name="saveEditFlag" value="1"/>
                    <!--f:param name="shortData" 
                    value="#{(currentUser.idUser!=linksMap.superUserCode or usrBean.idUser!=linksMap.superUserCode ? '1' : ())}"/-->
              </a4j:commandButton>
             </td>
            </tr>
           </table>
          </h:form>
         <!--/div-->
     </rich:modalPanel>
  </a4j:outputPanel>
  
  <a4j:outputPanel id="outCBmpUpdRole">  
      <rich:modalPanel id="CBmpUpdRole" rendered="#{param['onUpdateRole']!=null}"
        width="600" autosized="true" onbeforeshow="setHDiv('CBmpUpdRoleHDiv');">
        <f:facet name="header">
            <h:panelGroup>
                <h:outputText value="Пользователь"></h:outputText>
             </h:panelGroup>
        </f:facet>
        <f:facet name="controls">
            <h:panelGroup>
                <h:graphicImage onclick="#{rich:component('CBmpUpdRole')}.hide();"
                value="/img/icons/close.gif"/>
              </h:panelGroup>
        </f:facet>
        <div id="CBmpUpdRoleHDiv" style="width:100%;height:500px;overflow:auto;">
        <h:form id="CBformUpdRole">
        
        <!--h:inputHidden id ="uorgid" value="#{usrBean.acClOrganization}"/>
        <h:inputHidden id ="ucluid" value="#{usrBean.acClUser}"/-->
          
         <table style="width:90%;">
     
           
            <tr>
             <td width="100px" valign="top">
               <h:outputText value="Роли:"/>
             </td>
             <td style="padding-top:5px;">
               <rich:dataTable id="CBdtUpd" style="width:100%" 
                               rowKeyVar="rkv" var="record"
                               value="#{usrManager.listUsrArmEdit}">
                      <f:facet name="header">
                        <rich:columnGroup>
                          <rich:column colspan="2">
                              <h:outputText value="Название" />
                          </rich:column>
                        </rich:columnGroup>
                     </f:facet>
 
                     <rich:column colspan="2" style="font-weight:bold;">
                       <h:outputText value=" #{record.name}:" />
                    </rich:column>
                    <rich:subTable rowKeyVar="rkvs" id="CBsdtUpd"
                                   var="it" value="#{record.acRoles}">
                         <!--rich:column style="padding-left:30px;"
 	                      rendered="#{record.idArm!=1 or it.sign!='role:urn:sys_admin_cud' or currentUser.idUser==linksMap.superUserCode}"-->
                                 
 	                    <rich:column style="padding-left:30px;">
                       <h:selectBooleanCheckbox value="#{it.usrChecked}" id="CBsdtchbUpd"
                          onchange=""
                          onclick="fooNameUpd(this,'CBformUpd:CBdtUpd:'+#{rkv}+':CBsdtUpd:'+#{rkvs});" 
                          disabled="#{param['remoteAudit']!='UpdFact' and (!(currentUser.idUser!=linksMap.superUserCode or usrBean.idUser!=linksMap.superUserCode) 
                                      or !(record.idArm!=linksMap.appCode or it.sign!='role:urn:sys_admin_cud' or currentUser.idUser==linksMap.superUserCode)
                                      or (currentUser.isSysAdmin!=1 and record.idArm==linksMap.appCode))}"/>    
             
             <!--    disabled="#{usrManager.getDisabled(record.idArm, it.sign, usrBean.idUser)}"/> -->                         
                          <h:outputText value=" #{it.roleTitle}"/>
                       </rich:column>
                       <!--rich:column  style="width:60px;">
              <a4j:commandLink id="CBsdtcl1Upd" rendered="#{it.isRaions==1}" 
                 onclick="#{rich:component('CBsdtmpUpd')}.show();return false;"
                 style="#{it.usrChecked ? 'display:block' : 'display:none'}">
                     <h:graphicImage value="/img/icons/edit.gif"/>
                      <h:outputText value=" Районы" />
              </a4j:commandLink>
              <a4j:commandLink id="CBsdtcl2Upd" rendered="#{it.isRaions==1}" 
                 onclick="return false;" styleClass="raionDisable"
                 style="#{it.usrChecked ? 'display:none' : 'display:block'}">
                     <h:graphicImage value="/img/icons/edit.gif"/>
                      <h:outputText value=" Районы" />
              </a4j:commandLink>
             <rich:modalPanel id="CBsdtmpUpd"
                 width="200" autosized="true">
                <f:facet name="header">
                  <h:panelGroup>
                    <h:outputText value="Районы Санкт-Петербурга"></h:outputText>
                  </h:panelGroup>
               </f:facet>
               <f:facet name="controls">
                 <h:panelGroup>
                    <h:graphicImage onclick="#{rich:component('CBsdtmpUpd')}.hide();"
                     value="/img/icons/close.gif"/>
                 </h:panelGroup>
                </f:facet>
	            <h:selectManyCheckbox value="#{it.raions}"
	                        layout="pageDirection">
	  	          <s:selectItems value="#{usrManager.raions}"
	  	               var="n"
	  	               label="#{n.name}"
                       itemValue="#{n.idRai}"/>   
                </h:selectManyCheckbox>
	            <div align="center">
	             <a4j:commandButton value="Сохранить"
                  onclick="#{rich:component('CBsdtmpUpd')}.hide(); return false;"
                  styleClass="but_class" />
                </div>
             </rich:modalPanel>
           </rich:column-->
                   </rich:subTable>
                 </rich:dataTable>
               </td>
            </tr>
            
            <!--/c:if-->
            
            <tr>
            <td colspan="2" align="center" height="35px">
                 <a4j:commandButton value="Отмена"
                     onclick="#{rich:component('CBmpUpdRole')}.hide();return false;"
                     styleClass="but_class"/>
                 <a4j:commandButton value="Сохранить"
                    action="#{usrManager.updUsrRole}"
                    reRender="outCenterCenter, outCenterBottom"
                    oncomplete="#{rich:component('CBmpUpdRole')}.hide();"
                    onclick="enableCHBox('CBformUpdRole')" 
                    styleClass="but_class">
                    <f:param name="onUpdateRole" value="1"/> 
                    <f:param name="remoteAudit" value="UpdFact"/> 
                    <f:param name="sessionId" value="#{param['sessionId']}"/>
                    <f:param name="saveEditFlag" value="1"/>
                    <!--f:param name="shortData" 
                    value="#{(currentUser.idUser!=linksMap.superUserCode or usrBean.idUser!=linksMap.superUserCode ? '1' : ())}"/-->
              </a4j:commandButton>
             </td>
            </tr>
           </table>
          </h:form>
         </div>
     </rich:modalPanel>
  </a4j:outputPanel>
  
  <a4j:outputPanel id="outCBmpDel">
   <rich:modalPanel id="CBmpDel" rendered="#{param['onDelete']!=null}"
                    width="300" autosized="true">
      <f:facet name="header">
            <h:panelGroup>
                <h:outputText value="Пользователь"/>
             </h:panelGroup>
      </f:facet>
       <f:facet name="controls">
            <h:panelGroup>
                <h:graphicImage onclick="#{rich:component('CBmpDel')}.hide();"
                value="/img/icons/close.gif" />
              </h:panelGroup>
        </f:facet>
        <h:form>
         <h:inputHidden value="#{usrBean.idUser}"/>
         
         <h:outputText style="display:block;margin-bottom:7px;"
          value="Удалить #{usrBean.fio}?"/>
         
         <div style="white-space: nowrap;text-align:center;">
             <a4j:commandButton value="Отмена" 
                onclick="#{rich:component('CBmpDel')}.hide();return false;"
                styleClass="but_class"/>
            <a4j:commandButton value="Удалить"
                    action="#{usrManager.delUsr}"
                    reRender="outCenterCenter, outCenterCenterFooter, outCenterBottom, outCenterCenterHeader"
                    oncomplete="#{rich:component('CBmpDel')}.hide();"
                    styleClass="but_class" >
                 <f:param name="onDelete" value="1"/>
                 <f:param name="remoteAudit" value="DelFact"/>
             </a4j:commandButton>
            </div>
           </h:form>
        </rich:modalPanel>
      </a4j:outputPanel>
      </div>
      
 <script>
//<![CDATA[
function fooName(t,st){
		   if(t.checked){
		        jQuery("a[name='"+st+":CBsdtcl1Crt']").css('display','block');
		        jQuery("a[name='"+st+":CBsdtcl2Crt']").css('display','none');
	       }else{
       	        jQuery("a[name='"+st+":CBsdtcl1Crt']").css('display','none');
       	        jQuery("a[name='"+st+":CBsdtcl2Crt']").css('display','block');
           }
};
function fooNameUpd(t,st){
	   if(t.checked){
	        jQuery("a[name='"+st+":CBsdtcl1Upd']").css('display','block');
	        jQuery("a[name='"+st+":CBsdtcl2Upd']").css('display','none');
    }else{
	        jQuery("a[name='"+st+":CBsdtcl1Upd']").css('display','none');
	        jQuery("a[name='"+st+":CBsdtcl2Upd']").css('display','block');
    }
};
/*
function check(tform){
 var msg="";
 if (document.getElementById(tform+":name1").value==""){
	  msg+="Нет Фамилии !\n";
  }
 if (document.getElementById(tform+":name2").value==""){
	  msg+="Нет Имени !\n";
 }
 if (document.getElementById(tform+":name3").value==""){
	  msg+="Нет Отчества !\n";
 }
 if (document.getElementById(tform+":email").value==""){
	  msg+="Нет E-mail !\n";
 }
 if (document.getElementById(tform+":tel").value==""){
	  msg+="Нет Телефона !\n";
  }
 if(tform=='CBformCrt') {
   if (document.getElementById(tform+":login").value==""){
	  msg+="Нет Логина !\n";
  }
 }
 if (document.getElementById(tform+":pass").value==""){
	  msg+="Нет Пароля !\n";
 }
 if (document.getElementById(tform+":org").value=="-1"){
     msg+="Не выбрана Организация!\n";
 }

 if(msg!=""){
  alert(msg);
  return true;
 }else{
  return false;
}
}*/

function check_crt(tform){
	 var msg="";
	 if (document.getElementById(tform+":clorgso").value==""){
		  msg+="Не выбрана Организация !\n";
	  }
	 if(document.getElementById(tform+":cluso")!=null){
	   if (document.getElementById(tform+":cluso").value==""){
		  msg+="Не выбран Пользователь !\n";
	   }
     }else{
    	 if (document.getElementById(tform+":name1").value==""){
    		  msg+="Нет Фамилии !\n";
    	  }
    	 if (document.getElementById(tform+":name2").value==""){
    		  msg+="Нет Имени !\n";
    	 }
    	 if (document.getElementById(tform+":name3").value==""){
    		  msg+="Нет Отчества !\n";
    	 }
     }
	/* if (document.getElementById(tform+":cert").value==""){
		  msg+="Нет Номера сертификата !\n";
	 }*/  
	 if (document.getElementById(tform+":login").value==""){
		  msg+="Нет Логина !\n";
	 }
	 if (document.getElementById(tform+":pass").value==""){
		  msg+="Нет Пароля !\n";
	 }
	
	 if(msg!=""){
	  alert(msg);
	  return true;
	 }else{
	  return false;
	}
}

function check_upd(tform){
	var msg="";
	if(document.getElementById(tform+":fio")==null){
	 if (document.getElementById(tform+":name1").value==""){
   		  msg+="Нет Фамилии !\n";
   	 }
   	 if (document.getElementById(tform+":name2").value==""){
   		  msg+="Нет Имени !\n";
   	 }
   	 if (document.getElementById(tform+":name3").value==""){
   		  msg+="Нет Отчества !\n";
   	 }
    }  
	 if (document.getElementById(tform+":pass").value==""){
		  msg+="Нет Пароля !\n";
	 }
	
	 if(msg!=""){
	  alert(msg);
	  return true;
	 }else{
	  return false;
	}
}

function setHDiv(hdiv){
	jQuery('#'+hdiv).height(Math.floor(jQuery(window).height()*(2/3)));
}

function hideMPCrt(){
	#{rich:component('CBmpCrt')}.hide();
}

function enableCHBox(tform){

	jQuery("input[name^='"+tform+":CBdtUpd'][type=checkbox]:disabled").removeAttr('disabled');
	
	/*var n= jQuery("input[name^='"+tform+":CBdtUpd'][type=checkbox]:disabled").length;

	alert(n);
	jQuery("input[name^='"+tform+":CBdtUpd'][type=checkbox]:disabled").removeAttr('disabled');

	n= jQuery("input[name^='"+tform+":CBdtUpd'][type=checkbox]:disabled").length;

	alert(n);*/
}

//CBformUpd:CBdtUpd:0:CBsdtUpd:0:CBsdtchbUpd
 
 
//]]>
</script>
</ui:composition>